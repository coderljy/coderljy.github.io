<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<!-- iOS Safari -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<!-- Chrome, Firefox OS and Opera Status Bar Color -->
<meta name="theme-color" content="#FFFFFF">
<link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css">
<link rel="stylesheet" type="text/css"
  href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.19.0/themes/prism.min.css">
<link rel="stylesheet" type="text/css" href="css/SourceSansPro.css">
<link rel="stylesheet" type="text/css" href="css/theme.css">
<link rel="stylesheet" type="text/css" href="css/notablog.css">
<!-- Favicon -->

  <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ“–&lt;/text&gt;&lt;/svg&gt;">

<style>
  :root {
    font-size: 20px;
  }
</style>
  <title>NIOè¯¦è§£&nbsp;|&nbsp;å¤•çš„åšå®¢</title>
  <meta property="og:type" content="blog">
  <meta property="og:title" content="NIOè¯¦è§£">
  
  
  <style>
    .DateTagBar {
      margin-top: 1.0rem;
    }
  </style>
</head>

<body>
  <nav class="Navbar">
  <a href="index.html">
    <div class="Navbar__Btn">
      
        <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ“–&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
      
      <span>Home</span>
    </div>
  </a>
  
    
  
    
      <span class="Navbar__Delim">&centerdot;</span>
      <a href="about.html">
        <div class="Navbar__Btn">
          
            <span><img class="inline-img-icon" src="data:image/svg+xml,&lt;svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22&gt;&lt;text text-anchor=%22middle%22 dominant-baseline=%22middle%22 x=%2250%22 y=%2255%22 font-size=%2280%22&gt;ğŸ˜€&lt;/text&gt;&lt;/svg&gt;"></span>&nbsp;
          
          <span>About</span>
        </div>
      </a>
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
    
  
</nav>
  <header class="Header">
    
    <div class="Header__Spacer Header__Spacer--NoCover">
    </div>
    
    <h1 class="Header__Title">NIOè¯¦è§£</h1>
    
  </header>
  <article id="https://www.notion.so/c0214f230ebb4d08b0a2048a8192dcdb" class="PageRoot"><h1 id="https://www.notion.so/f2537701c14d4ef38764cc1f423c1d63" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/f2537701c14d4ef38764cc1f423c1d63"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Bufferï¼ˆç¼“å†²åŒºï¼‰</span></span></h1><div id="https://www.notion.so/58e413c623034c478cb09d3858e8793d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Java NIO Bufferç”¨äºå’ŒNIO Channeläº¤äº’ã€‚æˆ‘ä»¬ä»Channelä¸­è¯»å–æ•°æ®åˆ°Bufferä¸­ï¼Œä»BufferæŠŠæ•°æ®å†™åˆ°Channelã€‚</span></span></p></div><div id="https://www.notion.so/6d8b3ce4b97041c194f70876e0566d6b" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ ¸å¿ƒç¼“å†²åŒºå¦‚ä¸‹ï¼š</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/e1121f5de11b4b86a6fecd7822fd6354" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">ByteBuffer</span></span></li><li id="https://www.notion.so/62fe0f8812354f33b1a93443c9b138e8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">CharBuffer</span></span></li><li id="https://www.notion.so/ed743dd14d4e4c80962c917afcd2d197" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">ShortBuffer</span></span></li><li id="https://www.notion.so/a0228bc50d02485e908361a84539ca3e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">IntBuffer</span></span></li><li id="https://www.notion.so/b24a973abb7b467a8b93072fb5ddaf04" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">FloatBuffer</span></span></li><li id="https://www.notion.so/d85b5b3c6abb4b67bfe8b0b993480ffd" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">DoubleBuffer</span></span></li><li id="https://www.notion.so/45cf0a8372f341919cd1e04260014cb9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">LongBuffer</span></span></li></ul><div id="https://www.notion.so/e0f8d4c8b658454faa6b58f845f76b0f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åˆ©ç”¨Bufferè¯»å†™æ•°æ®ï¼Œé€šå¸¸éµå¾ªå››ä¸ªæ­¥éª¤ï¼š</strong></span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/ea09122d26a041c1a881c3be3f0b6967" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">æŠŠæ•°æ®å†™å…¥Bufferï¼ˆBufferè¢«åˆ›å»ºæ—¶æ˜¯å†™æ¨¡å¼ï¼‰</span></span></li><li id="https://www.notion.so/7827ee782eaf4b7eabd61c499cca837e" class="NumberedList" value="2"><span class="SemanticStringArray"><span class="SemanticString">è°ƒç”¨flipï¼ˆï¼‰å‡½æ•°ï¼ˆå°†Bufferä»å†™æ¨¡å¼ï¼Œè½¬æ¢ä¸ºè¯»æ¨¡å¼ï¼‰</span></span></li><li id="https://www.notion.so/f8849c50427049038787e6bd7eb9378c" class="NumberedList" value="3"><span class="SemanticStringArray"><span class="SemanticString">ä»Bufferä¸­è¯»å–æ•°æ®</span></span></li><li id="https://www.notion.so/a978dba62ce44003b7d495f5816fc034" class="NumberedList" value="4"><span class="SemanticStringArray"><span class="SemanticString">è°ƒç”¨buffer.clear()æˆ–è€…buffer.compact() ï¼ˆé‡ç½®Bufferï¼Œè½¬ä¸ºå†™æ¨¡å¼ï¼‰</span></span></li></ol><div id="https://www.notion.so/f6d77240683d4f669a753e7996675fdc" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å½“å†™å…¥æ•°æ®åˆ°bufferä¸­æ—¶ï¼Œbufferä¼šè®°å½•å·²ç»å†™å…¥çš„æ•°æ®å¤§å°ã€‚å½“éœ€è¦è¯»æ•°æ®æ—¶ï¼Œé€šè¿‡ flip() æ–¹æ³•æŠŠbufferä»å†™æ¨¡å¼è°ƒæ•´ä¸ºè¯»æ¨¡å¼ï¼›åœ¨è¯»æ¨¡å¼ä¸‹ï¼Œå¯ä»¥è¯»å–æ‰€æœ‰å·²ç»å†™å…¥çš„æ•°æ®ã€‚ å½“è¯»å–å®Œæ•°æ®åï¼Œéœ€è¦æ¸…ç©ºbufferï¼Œè½¬æ¢ä¸ºå†™å…¥æ“ä½œã€‚æ¸…ç©ºbufferæœ‰ä¸¤ç§æ–¹å¼ï¼šè°ƒç”¨ clear() æˆ– compact() æ–¹æ³•ã€‚clearä¼šæ¸…ç©ºæ•´ä¸ªbufferï¼Œcompactåˆ™åªæ¸…ç©ºå·²è¯»å–çš„æ•°æ®ï¼Œæœªè¢«è¯»å–çš„æ•°æ®ä¼šè¢«ç§»åŠ¨åˆ°bufferçš„å¼€å§‹ä½ç½®ï¼Œå†™å…¥ä½ç½®åˆ™è¿‘è·Ÿç€æœªè¯»æ•°æ®ä¹‹åã€‚</span></span></p></div><div id="https://www.notion.so/00fa19c510fd4f8bb2329081744f8ed8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Bufferçš„ä¸‰ç§å±æ€§ï¼š</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b30f0ab04f0947129ddab199556e8141" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">capacityå®¹é‡</span></span><blockquote id="https://www.notion.so/c09d4070b7ee4bb68444008343816f8b" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">å®¹é‡ï¼ˆCapacityï¼‰ ä½œä¸ºä¸€å—å†…å­˜ï¼Œbufferæœ‰ä¸€ä¸ªå›ºå®šçš„å¤§å°ï¼Œå«åšcapacitï¼ˆå®¹é‡ï¼‰ã€‚ä¹Ÿå°±æ˜¯æœ€å¤šåªèƒ½å†™å…¥å®¹é‡å€¼å¾—å­—èŠ‚ï¼Œæ•´å½¢ç­‰æ•°æ®ã€‚ä¸€æ—¦bufferå†™æ»¡äº†å°±éœ€è¦æ¸…ç©ºå·²è¯»æ•°æ®ä»¥ä¾¿ä¸‹æ¬¡ç»§ç»­å†™å…¥æ–°çš„æ•°æ®.</span></span></blockquote></li><li id="https://www.notion.so/806fa6f97ce4483997615a0a9c1699a8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">positionä½ç½®</span></span><blockquote id="https://www.notion.so/9bc97cf96f8045fda02c5b1b51cbde4a" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">ä½ç½®ï¼ˆPositionï¼‰ å½“å†™å…¥æ•°æ®åˆ°Bufferçš„æ—¶å€™éœ€è¦ä»ä¸€ä¸ªç¡®å®šçš„ä½ç½®å¼€å§‹ï¼Œé»˜è®¤åˆå§‹åŒ–æ—¶è¿™ä¸ªä½ç½®positionä¸º0ï¼Œä¸€æ—¦å†™å…¥äº†æ•°æ®æ¯”å¦‚ä¸€ä¸ªå­—èŠ‚ï¼Œæ•´å½¢æ•°æ®ï¼Œé‚£ä¹ˆpositionçš„å€¼å°±ä¼šæŒ‡å‘æ•°æ®ä¹‹åçš„ä¸€ä¸ªå•å…ƒï¼Œpositionæœ€å¤§å¯ä»¥åˆ°capacity-1.
å½“ä»Bufferè¯»å–æ•°æ®æ—¶ï¼Œä¹Ÿéœ€è¦ä»ä¸€ä¸ªç¡®å®šçš„ä½ç½®å¼€å§‹ã€‚bufferä»å†™å…¥æ¨¡å¼å˜ä¸ºè¯»å–æ¨¡å¼æ—¶ï¼Œpositionä¼šå½’é›¶ï¼Œæ¯æ¬¡è¯»å–åï¼Œpositionå‘åç§»åŠ¨ã€‚</span></span></blockquote></li><li id="https://www.notion.so/8a2888d7c4b349a79afa886eb8e238ed" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">limité™åˆ¶</span></span><blockquote id="https://www.notion.so/7ec673ff6776488b83a7a35a6c3eb438" class="ColorfulBlock ColorfulBlock--ColorDefault Quote"><span class="SemanticStringArray"><span class="SemanticString">ä¸Šé™ï¼ˆLimitï¼‰ åœ¨å†™æ¨¡å¼ï¼Œlimitçš„å«ä¹‰æ˜¯æˆ‘ä»¬æ‰€èƒ½å†™å…¥çš„æœ€å¤§æ•°æ®é‡ï¼Œå®ƒç­‰åŒäºbufferçš„å®¹é‡ã€‚ä¸€æ—¦åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œlimitåˆ™ä»£è¡¨æˆ‘ä»¬æ‰€èƒ½è¯»å–çš„æœ€å¤§æ•°æ®é‡ï¼Œä»–çš„å€¼ç­‰åŒäºå†™æ¨¡å¼ä¸‹positionçš„ä½ç½®ã€‚</span></span></blockquote></li></ul><h2 id="https://www.notion.so/ca6ad40ae2834fc2b4cb40f9855dcee2" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ca6ad40ae2834fc2b4cb40f9855dcee2"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Buffer å¸¸è§ç”¨æ³•</span></span></h2><div id="https://www.notion.so/c42fb10ad3b94a378638f1e4272eaaf6" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è¿™é‡Œç”¨ByteBufferä¸ºä¾‹</span></span></p></div><h3 id="https://www.notion.so/08e46df64f274646bacd1707f632346e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/08e46df64f274646bacd1707f632346e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">åˆ†é…ç¼“å†²åŒº</span></span></h3><pre id="https://www.notion.so/9aba9f60f07f4d658994ff3980c1c476" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>ByteBuffer buf = ByteBuffer.allocate(28);
</span></span></span></code></pre><h3 id="https://www.notion.so/ab4811c49a324dc291a5e871153d85b5" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/ab4811c49a324dc291a5e871153d85b5"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">å†™å…¥æ•°æ®</span></span></h3><pre id="https://www.notion.so/619bb83610f945e390e3360362f22a0f" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buf.put(i)
</span></span></span></code></pre><div id="https://www.notion.so/75e3820d7c164708b010170ef40684a3" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æºç å¦‚ä¸‹ï¼š</strong></span></span></p></div><pre id="https://www.notion.so/e8055bf569bb40eea0978bbbd4f6874b" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public ByteBuffer put(byte x) {
    hb[ix(nextPutIndex())] = x; //hbä¸ºå­˜æ”¾åœ¨heapçš„åº•å±‚æ•°ç»„
    return this;
}

final int nextPutIndex() {                          // package-private
    if (position &gt;= limit)
        throw new BufferOverflowException();
    return position++;
}

protected int ix(int i) {
    return i + offset;  //è¿™é‡Œoffsetåˆå§‹å€¼ä¸º0
}

</span></span></span></code></pre><h3 id="https://www.notion.so/9fd6e9aab38c4383984fbe1a7b9e5101" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/9fd6e9aab38c4383984fbe1a7b9e5101"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">æ¨¡å¼è½¬æ¢</span></span></h3><pre id="https://www.notion.so/0ad1241365f14b7ca143f90bbeabe571" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buf.flip() //å°†å†™å…¥æ¨¡å¼è½¬æ¢ä¸ºè¯»å–æ¨¡å¼
</span></span></span></code></pre><div id="https://www.notion.so/2562f5592dfa4f8fa7345d22f3a9d3da" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æºç å¦‚ä¸‹ï¼š</strong></span></span></p></div><pre id="https://www.notion.so/0be57925bb6440a595ea86aa51ccc62d" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public final Buffer flip() {
    limit = position;
    position = 0;
    mark = -1;
    return this;
}
</span></span></span></code></pre><div id="https://www.notion.so/943b802952914ccfb6377acdb5f3c9f8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è°ƒç”¨flip()æ–¹æ³•ï¼Œä¼šå°†limitä½ç½®è®¾ç½®ä¸ºå†™å…¥æ¨¡å¼æ—¶çš„positionï¼Œå³limitå˜ä¸ºå†™å…¥æ•°æ®çš„æœ€å¤§åæ ‡ï¼›positionè®¾ç½®ä¸º0ï¼Œä»£è¡¨å¯ä»¥ä»0å¼€å§‹è¯»å–æ•°æ®ï¼›mark = -1 ,å³å°†marké‡ç½®ã€‚</span></span></p></div><h3 id="https://www.notion.so/a2c639d454d84cd69dc38b4b394c3649" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/a2c639d454d84cd69dc38b4b394c3649"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">æ•°æ®è¯»å–</span></span></h3><pre id="https://www.notion.so/1f7783da21e14a159d352876c9600aca" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buf.get()
</span></span></span></code></pre><div id="https://www.notion.so/9e715f0222834c5cb618a2242299c7fa" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æºç å¦‚ä¸‹ï¼š</strong></span></span></p></div><pre id="https://www.notion.so/3781cc2f24cb4c94b784c7e8a6d3a048" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public byte get() {
    return hb[ix(nextGetIndex())]; //hbä¸ºå­˜æ”¾åœ¨heapçš„åº•å±‚æ•°ç»„
}

final int nextGetIndex() {                          // package-private
    if (position &gt;= limit)
        throw new BufferUnderflowException();
    return position++;
}

protected int ix(int i) {
    return i + offset;
}

</span></span></span></code></pre><h3 id="https://www.notion.so/f9f483fb47e14a27bc7ea55d8736944f" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/f9f483fb47e14a27bc7ea55d8736944f"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">é‡å¤è¯»å–</span></span></h3><pre id="https://www.notion.so/d6a4a4123033403c863635a8ec81febb" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buf.rewind()
</span></span></span></code></pre><div id="https://www.notion.so/85e00a29afdd49de87fcde27f157a15f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æºç å¦‚ä¸‹ï¼š</strong></span></span></p></div><pre id="https://www.notion.so/4bcdb5a85e66420a8162955965ced950" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public final Buffer rewind() {
    position = 0;
    mark = -1;
    return this;
}
</span></span></span></code></pre><div id="https://www.notion.so/9a96d4d3777640a883e7a0c1a7f612c0" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Buffer.rewind()æ–¹æ³•å°†positionç½®ä¸º0ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥é‡å¤è¯»å–bufferä¸­çš„æ•°æ®ã€‚limitä¿æŒä¸å˜ã€‚</span></span></p></div><h3 id="https://www.notion.so/20816acdf8164fb5b3dbdf648688e226" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/20816acdf8164fb5b3dbdf648688e226"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Bufferé‡ç½®</span></span></h3><div id="https://www.notion.so/b3276a4f0c964532b24c80c88600b8e4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é‡ç½®åå˜ä¸ºå†™æ¨¡å¼</span></span></p></div><pre id="https://www.notion.so/a0be066dad98447595441d247ce5f67b" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buf.clear()


buf.compact()
</span></span></span></code></pre><div id="https://www.notion.so/f026f9cd36454ae6b87d20ab97754452" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸€æ—¦Bufferä¸­è¯»å–å®Œæ•°æ®ï¼Œéœ€è¦å¤ç”¨Bufferä¸ºä¸‹æ¬¡å†™æ•°æ®åšå‡†å¤‡ã€‚</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/daa78304994e4baeb7943247c72f14e7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">clear()</span></span><pre id="https://www.notion.so/7a74b4a7f66149eb98a00bdb54ed26fa" class="Code"><code><span class="SemanticStringArray"></span></code></pre></li></ul><div id="https://www.notion.so/3c0c72797f5647b9844fff175d0b5dc4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">public final Buffer clear() {
position = 0;
limit = capacity;
mark = -1;
return this;
}</span></span></p></div><pre id="https://www.notion.so/21b7c92585424d75913b9b34ed3c72fc" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>è°ƒç”¨çš„æ˜¯clear()æ–¹æ³•ï¼Œpositionå°†è¢«è®¾å›0ï¼Œlimitè¢«è®¾ç½®æˆ capacityçš„å€¼ã€‚æ¢å¥è¯è¯´ï¼ŒBuffer è¢«æ¸…ç©ºäº†ã€‚Bufferä¸­çš„æ•°æ®å¹¶æœªæ¸…é™¤ï¼Œåªæ˜¯è¿™äº›æ ‡è®°å‘Šè¯‰æˆ‘ä»¬å¯ä»¥ä»å“ªé‡Œå¼€å§‹å¾€Bufferé‡Œå†™æ•°æ®ã€‚

- compact()

  ```Java
public ByteBuffer compact() {
    System.arraycopy(hb, ix(position()), hb, ix(0), remaining());
    position(remaining());
    limit(capacity());
    discardMark();
    return this;
}

System.arrayCopy(Object srcArray,int srcPos,Object destArray ,int destPos,int length)

å‚æ•°ï¼š

Object srcArray åŸæ•°ç»„ï¼ˆè¦æ‹·è´çš„æ•°ç»„ï¼‰
int srcPos è¦å¤åˆ¶çš„åŸæ•°ç»„çš„èµ·å§‹ä½ç½®ï¼ˆæ•°ç»„ä»0ä½ç½®å¼€å§‹ï¼‰
Object destArray ç›®æ ‡æ•°ç»„
int destPos ç›®æ ‡æ•°ç»„çš„èµ·å§‹ä½ç½®
int length åŸæ•°ç»„çš„é•¿åº¦

protected int ix(int i) {
    return i + offset; //offset é»˜è®¤ä¸º 0
}

public final int remaining() {
    return limit - position;
}

final void discardMark() {                          // package-private
    mark = -1;
}

</span></span></span></code></pre><div id="https://www.notion.so/809d9ddbe0164e66b317aefcbf4c6a24" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¦‚æœBufferä¸­ä»æœ‰æœªè¯»çš„æ•°æ®ï¼Œä¸”åç»­è¿˜éœ€è¦è¿™äº›æ•°æ®ï¼Œä½†æ˜¯æ­¤æ—¶æƒ³è¦å…ˆå†™äº›æ•°æ®ï¼Œé‚£ä¹ˆä½¿ç”¨compact()æ–¹æ³•ã€‚compact()æ–¹æ³•å°†æ‰€æœ‰æœªè¯»çš„æ•°æ®æ‹·è´åˆ°Bufferèµ·å§‹å¤„ã€‚ç„¶åå°†positionè®¾åˆ°æœ€åä¸€ä¸ªæœªè¯»å…ƒç´ æ­£åé¢ã€‚limitå±æ€§ä¾ç„¶åƒclear()æ–¹æ³•ä¸€æ ·ï¼Œè®¾ç½®æˆcapacityã€‚</span></span></p></div><h3 id="https://www.notion.so/30b5629d462247159099f02c3ef22aa8" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/30b5629d462247159099f02c3ef22aa8"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Bufferæ ‡è®°</span></span></h3><div id="https://www.notion.so/745b641bf2c84bb2a0c738cdc33c7012" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é€šè¿‡è°ƒç”¨Buffer.mark()æ–¹æ³•ï¼Œå¯ä»¥æ ‡è®°Bufferä¸­çš„ä¸€ä¸ªç‰¹å®špositionã€‚ä¹‹åå¯ä»¥é€šè¿‡è°ƒç”¨Buffer.reset()æ–¹æ³•æ¢å¤åˆ°è¿™ä¸ªpositionã€‚</span></span></p></div><pre id="https://www.notion.so/39e00d9a0df74efa88b802b36c4e905a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>buffer.mark();
//call buffer.get() a couple of times, e.g. during parsing.
buffer.reset();  //set position back to mark.
</span></span></span></code></pre><div id="https://www.notion.so/a05f018373f14d6eaec76e6ae3b93655" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æºç å¦‚ä¸‹ï¼š</strong></span></span></p></div><pre id="https://www.notion.so/21522d1598a34c2e8f3e2af8aab1dd22" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public final Buffer mark() {
    mark = position;
    return this;
}

public final Buffer reset() {
    int m = mark;
    if (m &lt; 0)
        throw new InvalidMarkException();
    position = m;
    return this;
}

</span></span></span></code></pre><h3 id="https://www.notion.so/0f274fe8891645c7852024bb5c854f38" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0f274fe8891645c7852024bb5c854f38"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Buffer æ¯”è¾ƒ</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/ec4f3da352834833a5c36e4f1630bfd7" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">equals()</span></span></li></ul><pre id="https://www.notion.so/e13a1f08716548dc88a590dcfd94f9a6" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public boolean equals(Object ob) {
    if (this == ob)
        return true;
    if (!(ob instanceof ByteBuffer))
        return false;
    ByteBuffer that = (ByteBuffer)ob;
    if (this.remaining() != that.remaining())
        return false;
    int p = this.position();
    for (int i = this.limit() - 1, j = that.limit() - 1; i &gt;= p; i--, j--)
        if (!equals(this.get(i), that.get(j)))
            return false;
    return true;
}
</span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/31d62cce1d8346ab837ca15f07cba20a" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">compareTo()</span></span></li></ul><pre id="https://www.notion.so/c100ea7e1f5a45e9aa3c05dce610e1ec" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public int compareTo(ByteBuffer that) {
    int n = this.position() + Math.min(this.remaining(), that.remaining());
    for (int i = this.position(), j = that.position(); i &lt; n; i++, j++) {
        int cmp = compare(this.get(i), that.get(j));
        if (cmp != 0)
            return cmp;
    }
    return this.remaining() - that.remaining();
}
</span></span></span></code></pre><div id="https://www.notion.so/98a3eb3d5f8641a49d266fcac1883d7f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åˆ¤æ–­ä¸¤ä¸ªbufferç›¸å¯¹ï¼Œéœ€æ»¡è¶³ï¼š</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/f83b4db3a27c4c92956b8d9425802e20" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">ç±»å‹ç›¸åŒ</span></span></li><li id="https://www.notion.so/b656b597ded945e78ef1265ba23d73e0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">bufferä¸­å‰©ä½™å­—èŠ‚æ•°ç›¸åŒ</span></span></li><li id="https://www.notion.so/6852eed2b1584b03b03d2a7709707c9f" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">æ‰€æœ‰å‰©ä½™å­—èŠ‚ç›¸ç­‰</span></span></li></ul><div id="https://www.notion.so/0d9bea057bed4eaab68f317838db094f" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä»ä¸Šé¢çš„ä¸‰ä¸ªæ¡ä»¶å¯ä»¥çœ‹å‡ºï¼Œequalsåªæ¯”è¾ƒbufferä¸­çš„éƒ¨åˆ†å†…å®¹ï¼Œå¹¶ä¸ä¼šå»æ¯”è¾ƒæ¯ä¸€ä¸ªå…ƒç´ ã€‚ compareTo(): compareToä¹Ÿæ˜¯æ¯”è¾ƒbufferä¸­çš„å‰©ä½™å…ƒç´ ï¼Œåªä¸è¿‡è¿™ä¸ªæ–¹æ³•é€‚ç”¨äºæ¯”è¾ƒæ’åºçš„ï¼š</span></span></p></div><h1 id="https://www.notion.so/edce279a3b4a47d0940a6b3769adc84d" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/edce279a3b4a47d0940a6b3769adc84d"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Channel</span></span></h1><h2 id="https://www.notion.so/60c97a51b8c340c2a093ee5de3069f78" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/60c97a51b8c340c2a093ee5de3069f78"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Java NIO Channel çš„ç‰¹ç‚¹</span></span></h2><ul class="BulletedListWrapper"><li id="https://www.notion.so/4512b51db6c84ea29e1c1a35adc2afd8" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">OIOæµä¸€èˆ¬æ˜¯å•å‘çš„ï¼ˆåªèƒ½è¯»æˆ–è€…å†™ï¼‰ï¼Œé€šé“å¯ä»¥è¯»ä¹Ÿå¯ä»¥å†™</span></span></li><li id="https://www.notion.so/345fa9dc3ce94fa2934638841cd33271" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">OIOæµè¯»å†™æ˜¯é˜»å¡çš„ï¼Œè€Œé€šé“å¯ä»¥æ˜¯å¼‚æ­¥è¯»å†™çš„ã€‚</span></span></li><li id="https://www.notion.so/e9c07fe9bb644bb69a92a4599ce212e0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">é€šé“æ€»æ˜¯åŸºäºç¼“å†²åŒºBufferæ¥è¯»å†™ã€‚</span></span></li></ul><h2 id="https://www.notion.so/ff6917c6948d478290b0c279828a6dde" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/ff6917c6948d478290b0c279828a6dde"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Channelç±»å‹</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/0f783dba0f81449191dda998edce8696" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">FileChannel</span></span></li></ol><div id="https://www.notion.so/b93bf81420d64731808f6c9fa9db523c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç”¨äºæ–‡ä»¶è¯»å†™æ“ä½œ</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/9f018cb2c863482cbef65a6f01822a28" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">DatagramChannel</span></span></li></ol><div id="https://www.notion.so/fcaa5d0e7bf348acb7f1a7d126ba89c2" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç”¨äºUDPæ•°æ®è¯»å†™</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/d8d518c5bba246fbab01a6893e567b91" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">SocketChannel</span></span></li></ol><div id="https://www.notion.so/a81746a0d0834effa35989aedcac543a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ç”¨äºTCPæ•°æ®è¯»å†™</span></span></p></div><ol class="NumberedListWrapper"><li id="https://www.notion.so/9ea88eb416784128805bd73a772b0bbf" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">ServerSocketChannel</span></span></li></ol><div id="https://www.notion.so/ddad907a09a445e7963bcea103dfd6d7" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å…è®¸æˆ‘ä»¬ç›‘å¬TCPé“¾æ¥è¯·æ±‚ï¼Œæ¯ä¸ªè¯·æ±‚ä¼šåˆ›å»ºä¸€ä¸ªSocketChannel</span></span></p></div><h2 id="https://www.notion.so/10fe508a8cdb47a29bab62b91dec0fb9" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/10fe508a8cdb47a29bab62b91dec0fb9"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Channelçš„ä½¿ç”¨</span></span></h2><h3 id="https://www.notion.so/aea1f84a6a424bee8d6d33dd8466a1cb" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/aea1f84a6a424bee8d6d33dd8466a1cb"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">FileChannel</span></span></h3><pre id="https://www.notion.so/69fa67a8ff104ae48d4c265cc05294b7" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>public static void main(String[] args) throws IOException {

    //è·å–FileChannelå¯¹è±¡
    RandomAccessFile file = new RandomAccessFile(&quot;test.txt&quot;,&quot;rw&quot;);
    FileChannel fileChannel = file.getChannel();

    //è¯»å–æ•°æ®åˆ°Buffer
    ByteBuffer buffer = ByteBuffer.allocate(48);
    int bytesRead = fileChannel.read(buffer);

    //å†™å…¥æ•°æ®
    String newData = &quot;New String to write to file...&quot; + System.currentTimeMillis();
    ByteBuffer buf = ByteBuffer.allocate(48);
    buf.clear();
    buf.put(newData.getBytes());
    buf.flip();
    while(buf.hasRemaining()) {
        fileChannel.write(buf);
    }

    //å…³é—­
    fileChannel.close();

    //å¼ºåˆ¶åˆ·æ–°ç£ç›˜
    //FileChannelçš„force()æ–¹æ³•å°†æ‰€æœ‰æœªå†™å…¥çš„æ•°æ®ä»é€šé“åˆ·æ–°åˆ°ç£ç›˜ä¸­ã€‚
    // åœ¨ä½ è°ƒç”¨è¯¥force()æ–¹æ³•ä¹‹å‰ï¼Œå‡ºäºæ€§èƒ½åŸå› ï¼Œæ“ä½œç³»ç»Ÿå¯èƒ½ä¼šå°†æ•°æ®ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œ
    // å› æ­¤æ‚¨ä¸èƒ½ä¿è¯å†™å…¥é€šé“çš„æ•°æ®å®é™…ä¸Šå†™å…¥ç£ç›˜ã€‚
    fileChannel.force(true);

}
</span></span></span></code></pre><h3 id="https://www.notion.so/24a534f7361b431fabb1223cf6deb4ee" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/24a534f7361b431fabb1223cf6deb4ee"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">DatagramChannel</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/3cfb560d90d34784b128cb96bcf9fd5e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">UDP Server</span></span></li></ul><pre id="https://www.notion.so/170f705ddfb74b5c83b1a9b2ba23e320" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package com.ljy.learn.nio.channel;

import java.io.IOException;
import java.net.DatagramSocket;
import java.net.InetSocketAddress;
import java.net.SocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.DatagramChannel;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.util.Iterator;
import java.util.Set;

/**
 * @author : å¤•
 * @date : 2019/9/24
 */
public class NIOUDPServer implements Runnable{

    private int port;

    public NIOUDPServer(int port){
        this.port = port;
        new Thread(this).start();
    }

    @Override
    public void run() {
        try {
            //å»ºç«‹DatagramChannel
            DatagramChannel datagramChannel = DatagramChannel.open();
            //è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼
            datagramChannel.configureBlocking(false);
            //è·å–DatagramSocket
            DatagramSocket datagramSocket = datagramChannel.socket();
            //è®¾ç½®æ¥æ”¶çš„bufferæœ€å¤§å€¼
            datagramSocket.setReceiveBufferSize(10240);
            //ç»‘å®šç«¯å£
            datagramSocket.bind(new InetSocketAddress(port));

            //DatagramChannelæ³¨å†Œåˆ°Selector
            Selector selector = Selector.open();
            datagramChannel.register(selector,SelectionKey.OP_READ);
            System.out.println(&quot;UDPServer æ­£åœ¨ç›‘å¬ç«¯å£ï¼š&quot; + port);

            //åˆ†é…æ•°æ®ç¼“å†²åŒº
            ByteBuffer byteBuffer = ByteBuffer.allocate(1024);

            //è®°å½•æ¥æ”¶çš„å­—èŠ‚æ€»æ•°
            int number = 0;
            while (true){
                //å¦‚æœé€‰æ‹©å™¨æ•°ç›®ä¸º0ï¼Œåˆ™ç»“æŸå¾ªç¯
                int selectNum = selector.select();
                if(selectNum == 0 ) {
                    continue;
                }
                //å¾—åˆ°é€‰æ‹©é”®åˆ—è¡¨
                Set keys = selector.selectedKeys();
                Iterator iterator = keys.iterator();
                while (iterator.hasNext()){
                    SelectionKey k = (SelectionKey) iterator.next();
                    //é€šè¿‡ä½è¿ç®—å¾—åˆ°é€šé“æ˜¯å¦æ­£å¸¸å‡†å¤‡
                    if( (k.readyOps() &amp; SelectionKey.OP_READ) == SelectionKey.OP_READ ){
                        //è·å–å®¢æˆ·ç«¯å‡†å¤‡å¥½çš„channel
                        DatagramChannel datagramChannelClient = (DatagramChannel) k.channel();
                        datagramChannelClient.configureBlocking(false);

                        //å…ˆå°†bufferæ¸…é™¤ï¼Œé˜²æ­¢æ•°æ®æ··åˆ
                        byteBuffer.clear();
                        //æ¥æ”¶æ•°æ®åˆ°buffer,è¿”å›ä»£è¡¨å®¢æˆ·ç«¯çš„SocketAddresså¯¹è±¡
                        SocketAddress socketAddressClient = datagramChannelClient.receive(byteBuffer);

                        //è¯»å–æ•°æ®
                        byteBuffer.flip();
                        //åˆ¤ç©ºæ“ä½œ
                        if(byteBuffer.remaining() &lt;= 0){
                            System.out.println(&quot;datagramChannelClient channel is null&quot;);
                        }
                        //è®°å½•æ¥æ”¶çš„å­—èŠ‚æ€»æ•°
                        number += byteBuffer.remaining();
                        byte[] bytes = new byte[byteBuffer.remaining()];
                        for (int i = 0;i&lt;byteBuffer.remaining();i++){
                            bytes[i] = byteBuffer.get(i);
                        }
                        String in = new String(bytes,&quot;utf-8&quot;);
                        System.out.println(number + &quot;::: Server æ¥æ”¶åˆ°ï¼š&quot; + in );

                        //è¿”å›å“åº”
                        byteBuffer.clear();
                        byteBuffer.put(&quot;welcome !!!&quot;.getBytes());
                        byteBuffer.flip();
                        datagramChannelClient.send(byteBuffer,socketAddressClient);
                    }
                }
                keys.clear();
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        new NIOUDPServer(1024);
    }

}
</span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/ffded847c2fa4ef6a4eee1105123079e" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">UDP Client</span></span></li></ul><pre id="https://www.notion.so/5b63d9ee48e34529b2ba87762f9b759a" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package com.ljy.learn.nio.channel;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.net.SocketAddress;
import java.nio.ByteBuffer;
import java.nio.channels.DatagramChannel;

/**
 * @author : å¤•
 * @date : 2019/9/24
 */
public class NIOUDPClient extends Thread{
    private String host;
    private int port;

    //è®°å½•æ¯ä¸ªclientå‘é€çš„å­—èŠ‚æ•°
    private int number;

    public NIOUDPClient(String host,int port,int threadNum){
        this.host = host;
        this.port = port;

        for(int i = 0;i &lt; threadNum;i++){
            new Thread(this).start();
        }
    }

    @Override
    public void run() {
        try{
            //æ„å»ºå®¢æˆ·ç«¯channel
            DatagramChannel datagramChannelClient = DatagramChannel.open();
            SocketAddress serverSocketAddress = new InetSocketAddress(host,port);
            datagramChannelClient.connect(serverSocketAddress);

            //æ„å»ºå‘é€æ•°æ®åŒ…
            ByteBuffer byteBuffer = ByteBuffer.allocate(128);

            byteBuffer.clear();
            byteBuffer.put(&quot;testClient&quot;.getBytes());
            byteBuffer.flip();

            //åˆ¤ç©ºæ“ä½œ
            if(byteBuffer.remaining() &lt;= 0){
                System.out.println(&quot;client data is null&quot;);
            }

            //å‘é€æ•°æ®
            int sendNum = datagramChannelClient.send(byteBuffer,serverSocketAddress);
            number += sendNum;
            System.out.println(&quot;å®¢æˆ·ç«¯å‘é€çš„å­—èŠ‚æ•°ï¼š&quot; + number);

            //æ¥æ”¶æœåŠ¡å™¨å“åº”
            byteBuffer.clear();
            datagramChannelClient.receive(byteBuffer);
            byteBuffer.flip();

            //è¯»å–æœåŠ¡å™¨å“åº”
            byte[] bytes = new byte[byteBuffer.remaining()];
            for(int i = 0;i&lt;byteBuffer.remaining();i++){
                bytes[i] = byteBuffer.get();
            }
            String res = new String(bytes,&quot;utf-8&quot;);
            System.out.println(&quot;client æ¥æ”¶ Server å“åº” ï¼š &quot; + res);

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        new NIOUDPClient(&quot;127.0.0.1&quot;,1024,5);
    }
}
</span></span></span></code></pre><h3 id="https://www.notion.so/170987950fb44a5c821abe4bc97901d3" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/170987950fb44a5c821abe4bc97901d3"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">ServerSocketChannel å’Œ SocketChannel</span></span></h3><ul class="BulletedListWrapper"><li id="https://www.notion.so/558b00eafe514551a85204fb9c311a50" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">TCP Server</span></span></li></ul><pre id="https://www.notion.so/cdc389201d7d48a5af069f6f7f898a53" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package com.ljy.learn.nio.channel;

import java.io.IOException;
import java.net.InetSocketAddress;
import java.net.ServerSocket;
import java.nio.ByteBuffer;
import java.nio.CharBuffer;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.nio.channels.ServerSocketChannel;
import java.nio.channels.SocketChannel;
import java.nio.charset.Charset;
import java.nio.charset.CharsetEncoder;
import java.util.Iterator;

/**
 * @author : å¤•
 * @date : 2019/9/25
 */
public class NIOTCPServer implements Runnable {

    private int port;

    public NIOTCPServer(int port) {
        this.port = port;
        new Thread(this).start();
    }

    @Override
    public void run() {
        try {
            //å»ºç«‹ ServerSocketChannel
            ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();
            //è®¾ç½®æˆéé˜»å¡æ¨¡å¼
            serverSocketChannel.configureBlocking(false);
            //è·å–ServerSocket
            ServerSocket serverSocket = serverSocketChannel.socket();
            //ç»‘å®šç«¯å£
            serverSocket.bind(new InetSocketAddress(port));

            //å°†ServerSocketChannelæ³¨å†Œåˆ°Selector
            Selector selector = Selector.open();
            serverSocketChannel.register(selector, SelectionKey.OP_ACCEPT);
            System.out.println(&quot;TCP Server æ­£åœ¨ç›‘å¬ç«¯å£ï¼š &quot; + port);

            while (true) {
                //è¿›è¡Œäº‹ä»¶ç›‘å¬è½®è¯¢
                int selectNum = selector.select();
                if (selectNum == 0) {
                    continue;
                }
                //è·å–é€‰æ‹©é”®çš„è¿­ä»£å™¨
                Iterator&lt;SelectionKey&gt; iterator = selector.selectedKeys().iterator();
                while (iterator.hasNext()) {
                    SelectionKey selectionKey = iterator.next();
                    iterator.remove();

                    //åˆ¤æ–­é€‰æ‹©é”®äº‹ä»¶ç±»å‹ï¼Œè¿›è¡Œå¤„ç†
                    if (selectionKey.isAcceptable()) {
                        //é€šè¿‡é€‰æ‹©é”®è·å–ServerSocketChannel
                        ServerSocketChannel serverSocketChannela = (ServerSocketChannel) selectionKey.channel();
                        //é€šè¿‡ServerSocketChannel è·å–ç›¸åº”çš„ SocketChannelï¼Œå»ºç«‹è¿æ¥: å°†Clientçš„SocketChannelæ³¨å†Œåˆ°
                        SocketChannel socketChannel = serverSocketChannela.accept();
                        socketChannel.configureBlocking(false);
                        socketChannel.register(selector, SelectionKey.OP_READ | SelectionKey.OP_WRITE);
                        System.out.println(&quot;å®¢æˆ·ç«¯ï¼š&quot;
                                + socketChannel.socket().getInetAddress().getHostName() + &quot;:&quot;
                                + socketChannel.socket().getPort() + &quot; è¿æ¥ä¸Šäº†&quot;);
                    }

                    if (selectionKey.isReadable()) {
                        SocketChannel socketChannel = (SocketChannel) selectionKey.channel();
                        //åˆ›å»ºæ¥æ”¶æ•°æ®çš„å®¹å™¨
                        ByteBuffer byteBuffer = ByteBuffer.allocate(128);
                        byteBuffer.clear();

                        try {
                            //ä»SocketChannelä¸­è¯»å–æ•°æ®åˆ°ByteBuffer
                            socketChannel.read(byteBuffer);

                        } catch (IOException e) {
                            //                          å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€è¿æ¥
                            System.out.println(&quot;å®¢æˆ·ç«¯ï¼š&quot;
                                    + socketChannel.socket().getInetAddress().getHostName() + &quot;:&quot;
                                    + socketChannel.socket().getPort() + &quot; å·²æ–­å¼€è¿æ¥&quot;);
                            socketChannel.close();
                            continue;
                        }

                        byteBuffer.flip();

                        byte[] bytes = byteBuffer.array();
                        String msg = new String(bytes, &quot;utf-8&quot;);

                        if (msg.equals(&quot;é€€å‡º&quot;)) {
//                          å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥
                            System.out.println(&quot;å®¢æˆ·ç«¯ï¼š&quot;
                                    + socketChannel.socket().getInetAddress().getHostName() + &quot;:&quot;
                                    + socketChannel.socket().getPort() + &quot; å·²æ–­å¼€è¿æ¥&quot;);
                            socketChannel.close();
                            continue;
                        }

                        System.out.println(
                                socketChannel.socket().getInetAddress().getHostName() + &quot;:&quot;
                                        + socketChannel.socket().getPort() + &quot;ï¼š&quot; + msg);

                        if (selectionKey.isWritable()) {
//                          System.out.println(&quot;å¯å†™&quot;);
                            CharsetEncoder encoder = Charset.forName(&quot;UTF-8&quot;).newEncoder();
                            try {
                                socketChannel.write(encoder.encode(CharBuffer.wrap(&quot;server receive your message &quot;)));
                            } catch (IOException e) {
                                // TODO: handle exception
                                System.out.println(&quot;å†™å…¥ioé”™è¯¯&quot;);
                            }
                        }


                    }


                }


            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        NIOTCPServer niotcpServer = new NIOTCPServer(1024);
    }
}
</span></span></span></code></pre><ul class="BulletedListWrapper"><li id="https://www.notion.so/6c11a2891d3b4137af64a827a2dafebc" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">TCP Client</span></span></li></ul><pre id="https://www.notion.so/450d1d25e0c24fc4ac42011c2a2eab2d" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>package com.ljy.learn.nio.channel;

/**
 * @author : å¤•
 * @date : 2019/9/25
 */

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.net.InetSocketAddress;
import java.nio.ByteBuffer;
import java.nio.CharBuffer;
import java.nio.channels.SelectionKey;
import java.nio.channels.Selector;
import java.nio.channels.SocketChannel;
import java.nio.charset.Charset;
import java.nio.charset.CharsetDecoder;
import java.nio.charset.CharsetEncoder;
import java.util.Iterator;

public class NIOTCPClient extends Thread {

    private CharsetDecoder decoder = Charset.forName(&quot;UTF-8&quot;).newDecoder();
    private CharsetEncoder encoder = Charset.forName(&quot;UTF-8&quot;).newEncoder();
    private Selector selector = null;
    private SocketChannel socket = null;
    private SelectionKey clientKey = null;

    public NIOTCPClient() {
        try {
            selector = Selector.open();
            socket = SocketChannel.open();
            socket.configureBlocking(false);
            clientKey = socket.register(selector, SelectionKey.OP_CONNECT);
            InetSocketAddress ip = new InetSocketAddress(&quot;localhost&quot;, 1024);
            socket.connect(ip);
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    @Override
    public void run() {
        try {
            while (true) {
                selector.select(1);
                Iterator&lt;SelectionKey&gt; it = selector.selectedKeys().iterator();
                while (it.hasNext()) {
                    SelectionKey key = it.next();
                    it.remove();
                    if (key.isConnectable()) {
                        SocketChannel channel = (SocketChannel) key.channel();
                        if (channel.isConnectionPending()) {
                            channel.finishConnect();
                        }
                        channel.register(selector, SelectionKey.OP_READ);
                        System.out.println(&quot;è¿æ¥æœåŠ¡å™¨ç«¯æˆåŠŸï¼&quot;);
                    } else if (key.isReadable()) {
                        SocketChannel channel = (SocketChannel) key.channel();
                        ByteBuffer buffer = ByteBuffer.allocate(50);
                        try {
                            channel.read(buffer);
                        } catch (IOException e) {
                            System.out.println(&quot;ä¸æœåŠ¡å™¨ï¼š&quot;
                                    + channel.socket().getInetAddress().getHostName() + &quot;:&quot;
                                    + channel.socket().getPort() + &quot;çš„è¿æ¥å·²æ–­å¼€&quot;);
                            channel.close();
                            continue;//è¿™ä¸€å¥æ˜¯ä¸ºäº†è®©ä½ çœ‹åˆ°æ‰“å°ä¿¡æ¯
                        }
                        buffer.flip();
                        String msg = decoder.decode(buffer).toString();
                        System.out.println(
                                channel.socket().getInetAddress().getHostName() + &quot;:&quot;
                                        + channel.socket().getPort() + &quot;ï¼š&quot; + msg);
                    }
                }
            }

        } catch (IOException e) {
            e.printStackTrace();
        } finally {
            try {
                selector.close();
                socket.close();
            } catch (IOException e) {
            }
        }
    }

    public void send(String msg) {
        try {
            SocketChannel client = (SocketChannel) clientKey.channel();
            client.write(encoder.encode(CharBuffer.wrap(msg)));
        } catch (Exception e) {
            System.out.println(&quot;å‘é€ä¿¡æ¯å¤±è´¥&quot;);
            e.printStackTrace();
        }
    }

    public void close() {
        try {
            selector.close();
            socket.close();
        } catch (IOException e) {
            e.printStackTrace();
        }
    }

    public static void main(String[] args) {
        NIOTCPClient client = new NIOTCPClient();
        client.start();
        BufferedReader sin = new BufferedReader(new InputStreamReader(System.in));
        try{
            String readline;
            while((readline = sin.readLine())!=null){
                if(readline.equals(&quot;bye&quot;)){
                    client.close();
                    System.exit(0);
                }
                client.send(readline);
            }
        }catch(IOException e){
            e.printStackTrace();
        }
    }

}

</span></span></span></code></pre><h1 id="https://www.notion.so/f6e658edaf4243428e1bc39937c453ee" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/f6e658edaf4243428e1bc39937c453ee"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Selector</span></span></h1><h2 id="https://www.notion.so/45cd151d4d7b4131bec5d4632e90ab1b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/45cd151d4d7b4131bec5d4632e90ab1b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">Selectorä»‹ç»</span></span></h2><div id="https://www.notion.so/2fc2db67741a404883ab180a618a8549" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">Selectorä¸€èˆ¬ç§°ä¸ºé€‰æ‹©å™¨,å½“ç„¶ä¹Ÿå¯ä»¥ç¿»è¯‘ä¸ºå¤šè·¯å¤ç”¨å™¨ã€‚å®ƒæ˜¯Java NIOæ ¸å¿ƒç»„ä»¶ä¸­çš„ä¸€ä¸ª,ç”¨äºæ£€æŸ¥ä¸€ä¸ªæˆ–å¤šä¸ªNIO Channelï¼ˆé€šé“ï¼‰çš„çŠ¶æ€æ˜¯å¦å¤„äºå¯è¯»ã€å¯å†™ã€‚å¦‚æ­¤å¯ä»¥å®ç°å•çº¿ç¨‹ç®¡ç†å¤šä¸ªchannel,ä¹Ÿå°±æ˜¯å¯ä»¥ç®¡ç†å¤šä¸ªç½‘ç»œé“¾æ¥ã€‚ ä½¿ç”¨Selectorçš„å¥½å¤„åœ¨äº:ä½¿ç”¨æ›´å°‘çš„çº¿ç¨‹æ¥å°±å¯ä»¥æ¥å¤„ç†é€šé“äº†,ç›¸æ¯”ä½¿ç”¨å¤šä¸ªçº¿ç¨‹,é¿å…äº†çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ã€‚</span></span></p></div><div id="https://www.notion.so/f2241e1033ed46ffb5cf335972146328" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¹¶ä¸æ˜¯æ‰€æœ‰çš„Channelï¼Œéƒ½æ˜¯å¯ä»¥è¢«Selector å¤ç”¨çš„ã€‚æ¯”å¦‚ï¼šFileChannelå°±ä¸èƒ½è¢«é€‰æ‹©å™¨å¤ç”¨ã€‚</span></span></p></div><div id="https://www.notion.so/aaab32ad813840e9a90c75c46db448ff" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åˆ¤æ–­ä¸€ä¸ªChannel èƒ½è¢«Selector å¤ç”¨ï¼Œæœ‰ä¸€ä¸ªå‰æï¼šåˆ¤æ–­ä»–æ˜¯å¦ç»§æ‰¿äº†ä¸€ä¸ªæŠ½è±¡ç±»SelectableChannelã€‚å¦‚æœç»§æ‰¿äº†SelectableChannelï¼Œåˆ™å¯ä»¥è¢«å¤ç”¨ï¼Œå¦åˆ™ä¸èƒ½ã€‚</span></span></p></div><div id="https://www.notion.so/d4b918a23a27472aa19629fda5ea95af" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">æ¯ä¸ªChannelçš„ç»§æ‰¿å®šä¹‰</strong></span></span></p></div><pre id="https://www.notion.so/6c654802eb234c2a9d447580c9c25801" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
public abstract class FileChannel
    extends AbstractInterruptibleChannel
    implements SeekableByteChannel, GatheringByteChannel,
    ScatteringByteChannel

public abstract class ServerSocketChannel
    extends AbstractSelectableChannel
    implements NetworkChannel

public abstract class DatagramChannel
    extends AbstractSelectableChannel
    implements ByteChannel, ScatteringByteChannel,
    GatheringByteChannel, MulticastChannel

public abstract class SocketChannel
    extends AbstractSelectableChannel
    implements ByteChannel, ScatteringByteChannel,
    GatheringByteChannel, NetworkChannel

</span></span></span></code></pre><div id="https://www.notion.so/2471040c461c45edb495c4a26f0e9e2c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">ä¸Šè¿°ç»§æ‰¿å…³ç³»ï¼Œè·Ÿsocketæœ‰å…³çš„ç±»éƒ½ç»§æ‰¿è‡ªAbstractSelectableChannelï¼Œè€ŒAbstractSelectableChannelåˆç»§æ‰¿è‡ªSelectableChannel</strong></span></span></p></div><pre id="https://www.notion.so/7aa5f3f01b2a496299f8b5f02b5aad76" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
public abstract class AbstractSelectableChannel
    extends SelectableChannel

</span></span></span></code></pre><div id="https://www.notion.so/aa308aee43304d11b9cf53c754178f1c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">SelectableChannelç±»æä¾›äº†å®ç°é€šé“çš„å¯é€‰æ‹©æ€§æ‰€éœ€è¦çš„å…¬å…±æ–¹æ³•ã€‚å®ƒæ˜¯æ‰€æœ‰æ”¯æŒå°±ç»ªæ£€æŸ¥çš„é€šé“ç±»çš„çˆ¶ç±»ã€‚æ‰€æœ‰socketé€šé“ï¼Œéƒ½ç»§æ‰¿äº†SelectableChannelç±»éƒ½æ˜¯å¯é€‰æ‹©çš„ï¼ŒåŒ…æ‹¬ä»ç®¡é“(Pipe)å¯¹è±¡çš„ä¸­è·å¾—çš„é€šé“ã€‚è€ŒFileChannelç±»ï¼Œæ²¡æœ‰ç»§æ‰¿SelectableChannelï¼Œå› æ­¤æ˜¯ä¸æ˜¯å¯é€‰é€šé“ã€‚</span></span></p></div><div id="https://www.notion.so/a820e708bd464d13b7ebc1f25cbe9f1c" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é€šé“å’Œé€‰æ‹©å™¨ä¸æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ã€‚ä¸€ä¸ªé€šé“å¯ä»¥è¢«æ³¨å†Œåˆ°å¤šä¸ªé€‰æ‹©å™¨ä¸Šï¼Œä½†å¯¹æ¯ä¸ªé€‰æ‹©å™¨è€Œè¨€åªèƒ½è¢«æ³¨å†Œä¸€æ¬¡ã€‚</span></span></p></div><div id="https://www.notion.so/d922180967b44ca4844773937f244b57" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é€šé“å’Œé€‰æ‹©å™¨ä¹‹é—´çš„å…³ç³»ï¼Œä½¿ç”¨æ³¨å†Œçš„æ–¹å¼å®Œæˆã€‚SelectableChannelå¯ä»¥è¢«æ³¨å†Œåˆ°Selectorå¯¹è±¡ä¸Šï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šé€šé“çš„å“ªäº›æ“ä½œï¼Œæ˜¯Selectoræ„Ÿå…´è¶£çš„ã€‚</span></span></p></div><h2 id="https://www.notion.so/c935889e15cf4170a52a12f1fae93a2b" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/c935889e15cf4170a52a12f1fae93a2b"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">SelectoråŸºæœ¬ä½¿ç”¨</span></span></h2><ol class="NumberedListWrapper"><li id="https://www.notion.so/7cd1b7f111514270bf0d5d1b1edeb44c" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">åˆ›å»ºSelector</span></span></li></ol><pre id="https://www.notion.so/bdd59ff0e2a14ca09135e72b763e5292" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>Selector selector = Selector.open();
</span></span></span></code></pre><ol class="NumberedListWrapper"><li id="https://www.notion.so/0680b6bd4ce94746b498ba6744909fca" class="NumberedList" value="1"><span class="SemanticStringArray"><span class="SemanticString">Channelè®¾ç½®ä¸ºéé˜»å¡çš„ï¼Œæ³¨å†Œchannelåˆ°Selector,å¹¶è®¾ç½®æ„Ÿå…´è¶£çš„ç›‘å¬äº‹ä»¶</span></span></li></ol><pre id="https://www.notion.so/c5b9e8b57237482a9e4969f42c4671f1" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>channel.configureBlocking(false);

SelectionKey key = channel.register(selector, Selectionkey.OP_READ);
</span></span></span></code></pre><h3 id="https://www.notion.so/dc94caee69d6435a8ccbeac5a5233f00" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/dc94caee69d6435a8ccbeac5a5233f00"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">ç›‘å¬äº‹ä»¶</span></span></h3><div id="https://www.notion.so/9a19902efe9043869b6cbbde76abcb67" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">register() æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œ interesté›†åˆ â€ï¼Œæ„æ€æ˜¯åœ¨é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹ä»€ä¹ˆäº‹ä»¶æ„Ÿå…´è¶£ã€‚å¯ä»¥ç›‘å¬å››ç§ä¸åŒç±»å‹çš„äº‹ä»¶ï¼š</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/28e69af40002421db597a20021a8cf0c" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Connect</span></span></li><li id="https://www.notion.so/b45066ac3d5f4693befdb101d1b35679" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Accept</span></span></li><li id="https://www.notion.so/fa6e6653889147dc87ae3778ac9fb574" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Read</span></span></li><li id="https://www.notion.so/ae8d584e83104699b8e919042bdd4c46" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">Write</span></span></li></ul><div id="https://www.notion.so/0de18b5936194303b9181b3ef489c91e" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é€šé“è§¦å‘äº†ä¸€ä¸ªäº‹ä»¶æ„æ€æ˜¯è¯¥äº‹ä»¶å·²ç»å°±ç»ªã€‚æ¯”å¦‚ï¼š
æŸä¸ªChannelæˆåŠŸè¿æ¥åˆ°å¦ä¸€ä¸ªæœåŠ¡å™¨ç§°ä¸º&quot;è¿æ¥å°±ç»ª&quot;ã€‚ä¸€ä¸ªServerSocketChannelå‡†å¤‡å¥½æ¥æ”¶æ–°è¿›å…¥çš„è¿æ¥ç§°ä¸º&quot;æ¥æ”¶å°±ç»ª&quot;ã€‚ä¸€ä¸ªæœ‰æ•°æ®å¯è¯»çš„é€šé“å¯ä»¥è¯´æ˜¯&quot;è¯»å°±ç»ª&quot;ã€‚ç­‰å¾…å†™æ•°æ®çš„é€šé“å¯ä»¥è¯´æ˜¯&quot;å†™å°±ç»ª&quot;ã€‚
è¿™å››ç§äº‹ä»¶ç”¨SelectionKeyçš„å››ä¸ªå¸¸é‡æ¥è¡¨ç¤ºï¼š SelectionKey.OP_CONNECT SelectionKey.OP_ACCEPT SelectionKey.OP_READ SelectionKey.OP_WRITE</span></span></p></div><div id="https://www.notion.so/1dda676227bb4256b9db781d3bb44379" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¦‚æœä½ å¯¹ä¸æ­¢ä¸€ç§äº‹ä»¶æ„Ÿå…´è¶£ï¼Œä½¿ç”¨æˆ–è¿ç®—ç¬¦å³å¯ï¼Œå¦‚ä¸‹ï¼š int interestSet = SelectionKey.OP_READ | SelectionKey.OP_WRITE;</span></span></p></div><h2 id="https://www.notion.so/11b117f62f414f158036ebee8656c6de" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--2"><a class="Anchor" href="#https://www.notion.so/11b117f62f414f158036ebee8656c6de"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">SelectionKey</span></span></h2><div id="https://www.notion.so/9554ef6f09654c3bb073d7ef956997cd" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸€ä¸ªSelectionKeyé”®è¡¨ç¤ºäº†ä¸€ä¸ªç‰¹å®šçš„é€šé“å¯¹è±¡å’Œä¸€ä¸ªç‰¹å®šçš„é€‰æ‹©å™¨å¯¹è±¡ä¹‹é—´çš„æ³¨å†Œå…³ç³»ã€‚</span></span></p></div><pre id="https://www.notion.so/bf4edee2ccd74777b8436dff65d71030" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
key.attachment(); //è¿”å›SelectionKeyçš„attachmentï¼Œattachmentå¯ä»¥åœ¨æ³¨å†Œchannelçš„æ—¶å€™æŒ‡å®šã€‚
key.channel(); // è¿”å›è¯¥SelectionKeyå¯¹åº”çš„channelã€‚
key.selector(); // è¿”å›è¯¥SelectionKeyå¯¹åº”çš„Selectorã€‚
key.interestOps(); //è¿”å›ä»£è¡¨éœ€è¦Selectorç›‘æ§çš„IOæ“ä½œçš„bit mask
key.readyOps(); // è¿”å›ä¸€ä¸ªbit maskï¼Œä»£è¡¨åœ¨ç›¸åº”channelä¸Šå¯ä»¥è¿›è¡Œçš„IOæ“ä½œã€‚
</span></span></span></code></pre><h3 id="https://www.notion.so/56c833d7e84a49579cd0319b508e488a" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/56c833d7e84a49579cd0319b508e488a"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">key.interestOps()çš„ä½¿ç”¨</span></span></h3><pre id="https://www.notion.so/205ad82cc4c044b396c5a71a4f757a7d" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
int interestSet = selectionKey.interestOps();
boolean isInterestedInAccept = (interestSet &amp; SelectionKey.OP_ACCEPT) == SelectionKey.OP_ACCEPTï¼›
boolean isInterestedInConnect = interestSet &amp; SelectionKey.OP_CONNECT;
boolean isInterestedInRead = interestSet &amp; SelectionKey.OP_READ;
boolean isInterestedInWrite = interestSet &amp; SelectionKey.OP_WRITE;
</span></span></span></code></pre><h3 id="https://www.notion.so/2555161677464491bcdc94e79cdb2d49" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/2555161677464491bcdc94e79cdb2d49"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">key.readyOps()çš„ä½¿ç”¨</span></span></h3><div id="https://www.notion.so/ee8e8ff679c744d1bf1cb1838da26944" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ready é›†åˆæ˜¯é€šé“å·²ç»å‡†å¤‡å°±ç»ªçš„æ“ä½œçš„é›†åˆã€‚JAVAä¸­å®šä¹‰ä»¥ä¸‹å‡ ä¸ªæ–¹æ³•ç”¨æ¥æ£€æŸ¥è¿™äº›æ“ä½œæ˜¯å¦å°±ç»ª.</span></span></p></div><pre id="https://www.notion.so/7d45a82ea5884d5aae6a94e07ef1f375" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
//åˆ›å»ºreadyé›†åˆçš„æ–¹æ³•
int readySet = selectionKey.readyOps();
//æ£€æŸ¥è¿™äº›æ“ä½œæ˜¯å¦å°±ç»ªçš„æ–¹æ³•
boolean key.isAcceptable();//æ˜¯å¦å¯è¯»ï¼Œæ˜¯è¿”å› true
boolean key.isWritable()ï¼š//æ˜¯å¦å¯å†™ï¼Œæ˜¯è¿”å› true
boolean key.isConnectable()ï¼š//æ˜¯å¦å¯è¿æ¥ï¼Œæ˜¯è¿”å› true
boolean key.isAcceptable()ï¼š//æ˜¯å¦å¯æ¥æ”¶ï¼Œæ˜¯è¿”å› true
</span></span></span></code></pre><h3 id="https://www.notion.so/0c84e7c9a4fc4d68946981ffce33a260" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/0c84e7c9a4fc4d68946981ffce33a260"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">SelectionKeyé™„åŠ ä¿¡æ¯</span></span></h3><div id="https://www.notion.so/53633ac0efe34ca898bf24b56cab273d" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡æˆ–è€…æ›´å¤šä¿¡æ¯é™„ç€åˆ°SelectionKeyä¸Šï¼Œè¿™æ ·å°±èƒ½æ–¹ä¾¿çš„è¯†åˆ«æŸä¸ªç»™å®šçš„é€šé“ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é™„åŠ  ä¸é€šé“ä¸€èµ·ä½¿ç”¨çš„Bufferï¼Œæˆ–æ˜¯åŒ…å«èšé›†æ•°æ®çš„æŸä¸ªå¯¹è±¡ã€‚ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</span></span></p></div><pre id="https://www.notion.so/3a445ce8276648e68c887e834c54dbb3" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
key.attach(theObject);
Object attachedObj = key.attachment();

</span></span></span></code></pre><div id="https://www.notion.so/cb53e0bc33444d72b7b39421f17650ef" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">è¿˜å¯ä»¥åœ¨ç”¨register()æ–¹æ³•å‘Selectoræ³¨å†ŒChannelçš„æ—¶å€™é™„åŠ å¯¹è±¡ã€‚å¦‚ï¼š</span></span></p></div><pre id="https://www.notion.so/a5f4f87464a24ed3be27c55f2e04a90d" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
SelectionKey key = channel.register(selector, SelectionKey.OP_READ, theObject);

</span></span></span></code></pre><h3 id="https://www.notion.so/e76ce72339544fb2b9d5d44bc674bbbe" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/e76ce72339544fb2b9d5d44bc674bbbe"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">select()æ–¹æ³•çš„ä½¿ç”¨</span></span></h3><div id="https://www.notion.so/97099c2e3fee44dcba139eda9bc57036" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">Selectorç»´æŠ¤çš„ä¸‰ç§ç±»å‹SelectionKeyé›†åˆ:</strong></span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/b3a54966e40e43abbc623dd4305f9569" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">å·²æ³¨å†Œçš„é”®çš„é›†åˆ(Registered key set)</span></span></li><li id="https://www.notion.so/2eeea81402b24c1a99b364bb27618af0" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">å·²é€‰æ‹©çš„é”®çš„é›†åˆ(Selected key set)</span></span></li><li id="https://www.notion.so/0eefbbb930554849a1c3e48e1f2e6768" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">å·²å–æ¶ˆçš„é”®çš„é›†åˆ(Cancelled key set)</span></span></li></ul><div id="https://www.notion.so/5b46ef5709524667a984ee17747ce8f1" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">åœ¨åˆšåˆå§‹åŒ–çš„Selectorå¯¹è±¡ä¸­ï¼Œè¿™ä¸‰ä¸ªé›†åˆéƒ½æ˜¯ç©ºçš„ã€‚ é€šè¿‡Selectorçš„selectï¼ˆï¼‰æ–¹æ³•å¯ä»¥é€‰æ‹©å·²ç»å‡†å¤‡å°±ç»ªçš„é€šé“ ï¼ˆè¿™äº›é€šé“åŒ…å«ä½ æ„Ÿå…´è¶£çš„çš„äº‹ä»¶ï¼‰ã€‚æ¯”å¦‚: å¯¹è¯»å°±ç»ªçš„é€šé“æ„Ÿå…´è¶£ï¼Œé‚£ä¹ˆselectï¼ˆï¼‰æ–¹æ³•å°±ä¼šè¿”å›è¯»äº‹ä»¶å·²ç»å°±ç»ªçš„é‚£äº›é€šé“ã€‚</span></span></p></div><div id="https://www.notion.so/c8379d72816c4dc0883d631d38cfad0a" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">ä¸‹é¢æ˜¯Selectorå‡ ä¸ªé‡è½½çš„select()æ–¹æ³•ï¼š</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/64103ee3c2ea411bae5e5977e863d177" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">int select()ï¼šé˜»å¡åˆ°è‡³å°‘æœ‰ä¸€ä¸ªé€šé“åœ¨ä½ æ³¨å†Œçš„äº‹ä»¶ä¸Šå°±ç»ªäº†ã€‚</span></span></li><li id="https://www.notion.so/d5a449eb82ea4113a4ab542466feb2d9" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">int select(long timeout)ï¼šå’Œselect()ä¸€æ ·ï¼Œä½†æœ€é•¿é˜»å¡æ—¶é—´ä¸ºtimeoutæ¯«ç§’ã€‚</span></span></li><li id="https://www.notion.so/9b98a506f0624f7c980a52b84c9cd3ac" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">int selectNow()ï¼šéé˜»å¡ï¼Œåªè¦æœ‰é€šé“å°±ç»ªå°±ç«‹åˆ»è¿”å›ã€‚</span></span></li></ul><div id="https://www.notion.so/04d704bb2b79469c9a0e68cf98cf7576" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">select()æ–¹æ³•è¿”å›çš„intå€¼è¡¨ç¤ºæœ‰å¤šå°‘é€šé“å·²ç»å°±ç»ª,æ˜¯è‡ªä¸Šæ¬¡è°ƒç”¨select()æ–¹æ³•åæœ‰å¤šå°‘é€šé“å˜æˆå°±ç»ªçŠ¶æ€ã€‚ä¹‹å‰åœ¨selectï¼ˆï¼‰è°ƒç”¨æ—¶è¿›å…¥å°±ç»ªçš„é€šé“ä¸ä¼šåœ¨æœ¬æ¬¡è°ƒç”¨ä¸­è¢«è®°å…¥ï¼Œè€Œåœ¨å‰ä¸€æ¬¡selectï¼ˆï¼‰è°ƒç”¨è¿›å…¥å°±ç»ªä½†ç°åœ¨å·²ç»ä¸åœ¨å¤„äºå°±ç»ªçš„é€šé“ä¹Ÿä¸ä¼šè¢«è®°å…¥ã€‚</span></span></p></div><div id="https://www.notion.so/afd97fc84b724b74a51e7eecfea489e4" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString"><strong class="SemanticString__Fragment SemanticString__Fragment--Bold">åœæ­¢é€‰æ‹©çš„æ–¹æ³•ï¼š</strong></span></span></p></div><div id="https://www.notion.so/7ee2d0f7c44d4a1aae303f02a6952fc8" class="ColorfulBlock ColorfulBlock--ColorDefault Text"><p class="Text__Content"><span class="SemanticStringArray"><span class="SemanticString">é€‰æ‹©å™¨æ‰§è¡Œé€‰æ‹©çš„è¿‡ç¨‹ï¼Œç³»ç»Ÿåº•å±‚ä¼šä¾æ¬¡è¯¢é—®æ¯ä¸ªé€šé“æ˜¯å¦å·²ç»å°±ç»ªï¼Œè¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šé€ æˆè°ƒç”¨çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€,é‚£ä¹ˆæˆ‘ä»¬æœ‰ä»¥ä¸‹ä¸¤ç§æ–¹å¼å¯ä»¥å”¤é†’åœ¨selectï¼ˆï¼‰æ–¹æ³•ä¸­é˜»å¡çš„çº¿ç¨‹ã€‚</span></span></p></div><ul class="BulletedListWrapper"><li id="https://www.notion.so/c4705889c8554c4899a6bd1148d46fac" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">wakeup()æ–¹æ³• ï¼šé€šè¿‡è°ƒç”¨Selectorå¯¹è±¡çš„wakeupï¼ˆï¼‰æ–¹æ³•è®©å¤„åœ¨é˜»å¡çŠ¶æ€çš„select()æ–¹æ³•ç«‹åˆ»è¿”å› è¯¥æ–¹æ³•ä½¿å¾—é€‰æ‹©å™¨ä¸Šçš„ç¬¬ä¸€ä¸ªè¿˜æ²¡æœ‰è¿”å›çš„é€‰æ‹©æ“ä½œç«‹å³è¿”å›ã€‚å¦‚æœå½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„é€‰æ‹©æ“ä½œï¼Œé‚£ä¹ˆä¸‹ä¸€æ¬¡å¯¹select()æ–¹æ³•çš„ä¸€æ¬¡è°ƒç”¨å°†ç«‹å³è¿”å›ã€‚</span></span></li><li id="https://www.notion.so/10ead03959bc4fafb4e779ca905e2a55" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString">close()æ–¹æ³• ï¼šé€šè¿‡closeï¼ˆï¼‰æ–¹æ³•å…³é—­Selector è¯¥æ–¹æ³•ä½¿å¾—ä»»ä½•ä¸€ä¸ªåœ¨é€‰æ‹©æ“ä½œä¸­é˜»å¡çš„çº¿ç¨‹éƒ½è¢«å”¤é†’(ç±»ä¼¼wakeup()),åŒæ—¶ä½¿å¾—æ³¨å†Œåˆ°è¯¥Selectorçš„æ‰€æœ‰Channelè¢«æ³¨é”€ï¼Œæ‰€æœ‰çš„é”®å°†è¢«å–æ¶ˆï¼Œä½†æ˜¯Channelæœ¬èº«å¹¶ä¸ä¼šå…³é—­ã€‚</span></span></li></ul><h3 id="https://www.notion.so/95eaf6ef22ef47fb8dec8e08d1742854" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--3"><a class="Anchor" href="#https://www.notion.so/95eaf6ef22ef47fb8dec8e08d1742854"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">æ¨¡æ¿ä»£ç </span></span></h3><pre id="https://www.notion.so/d66792dad8b74e06b1a7102a4e3af628" class="Code"><code><span class="SemanticStringArray"><span class="SemanticString"><span>
ServerSocketChannel ssc = ServerSocketChannel.open();
ssc.socket().bind(new InetSocketAddress(&quot;localhost&quot;, 1024));
ssc.configureBlocking(false);

Selector selector = Selector.open();
ssc.register(selector, SelectionKey.OP_ACCEPT);

while(true) {
    int readyNum = selector.select();
    if (readyNum == 0) {
        continue;
    }

    Set&lt;SelectionKey&gt; selectedKeys = selector.selectedKeys();
    Iterator&lt;SelectionKey&gt; it = selectedKeys.iterator();

    while(it.hasNext()) {
        SelectionKey key = it.next();

        if(key.isAcceptable()) {
            // æ¥å—è¿æ¥
        } else if (key.isReadable()) {
            // é€šé“å¯è¯»
        } else if (key.isWritable()) {
            // é€šé“å¯å†™
        }

        it.remove();
    }
}

</span></span></span></code></pre><h1 id="https://www.notion.so/0c90a59eb3df45d38e9c185d5f43ef6e" class="ColorfulBlock ColorfulBlock--ColorDefault Heading Heading--1"><a class="Anchor" href="#https://www.notion.so/0c90a59eb3df45d38e9c185d5f43ef6e"><svg width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a><span class="SemanticStringArray"><span class="SemanticString">å‚è€ƒæ–‡ç« </span></span></h1><ul class="BulletedListWrapper"><li id="https://www.notion.so/d985757178ab43da8a9f38e8bfbeddaa" class="BulletedList"><span class="SemanticStringArray"><span class="SemanticString"><a class="SemanticString__Fragment SemanticString__Fragment--Link" href="https://github.com/wangzhiwubigdata/God-Of-BigData/blob/master/Java%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E5%A2%9E%E5%BC%BA/Java%20NIO%E4%B9%8BSelector(%E9%80%89%E6%8B%A9%E5%99%A8).md">https://github.com/wangzhiwubigdata/God-Of-BigData/blob/master/Javaé«˜çº§ç‰¹æ€§å¢å¼º/Java NIOä¹‹Selector(é€‰æ‹©å™¨).md</a></span></span></li></ul></article>
  <footer class="Footer">
  <div>&copy; å¤•çš„åšå®¢ 2022</div>
  <div>&centerdot;</div>
  <div>Powered by <a href="https://github.com/dragonman225/notablog" target="_blank"
      rel="noopener noreferrer">Notablog</a>.
  </div>
</footer>
</body>

</html>